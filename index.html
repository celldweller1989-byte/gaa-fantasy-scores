<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTcdzjZ4zYlGgFe5acS8xOb1vHR9b8i98UudIOe-iC9Z1d6x6AY5zATgX217cNjcNtAGDLJ56y8Jr8N/pub?gid=0&single=true&output=csv';

    async function loadFantasyData() {
        const tableBody = document.getElementById('tableBody');
        try {
            const response = await fetch(csvUrl + '&cache=' + new Date().getTime());
            const data = await response.text();
            
            // Convert CSV text into an array of rows, skipping the header
            let rows = data.split('\n').slice(1).filter(row => row.trim() !== '');

            // SORTING LOGIC: Sort by County (Index 0) then Position (Index 7)
            rows.sort((a, b) => {
                const colsA = a.split(',');
                const colsB = b.split(',');
                
                // Compare County
                if (colsA[0] < colsB[0]) return -1;
                if (colsA[0] > colsB[0]) return 1;

                // If County is same, compare Position (Column H is index 7)
                const posA = (colsA[7] || '').trim();
                const posB = (colsB[7] || '').trim();
                if (posA < posB) return -1;
                if (posA > posB) return 1;
                
                return 0;
            });

            tableBody.innerHTML = ''; 

            rows.forEach(row => {
                const cols = row.split(',');
                if (cols.length >= 6) {
                    const tr = document.createElement('tr');
                    
                    // Mapping your specific columns:
                    // cols[0]: County, cols[1]: First, cols[2]: Last, 
                    // cols[3]: Goals, cols[4]: Points, cols[5]: Fantasy, cols[7]: Position
                    
                    const firstName = (cols[1] || '').replace(/"/g, '');
                    const lastName = (cols[2] || '').replace(/"/g, '');
                    const county = (cols[0] || '').replace(/"/g, '');
                    const position = (cols[7] || 'N/A').replace(/"/g, '');

                    tr.innerHTML = `
                        <td>${firstName} ${lastName}</td>
                        <td>${county}</td>
                        <td>${position}</td>
                        <td>${cols[3] || '0'}</td>
                        <td>${cols[4] || '0'}</td>
                        <td class="score">${cols[5] || '0'}</td>
                    `;
                    tableBody.appendChild(tr);
                }
            });
        } catch (err) {
            console.error("Error loading data:", err);
        }
    }

    loadFantasyData();
</script>
