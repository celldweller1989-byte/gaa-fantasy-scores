<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTcdzjZ4zYlGgFe5acS8xOb1vHR9b8i98UudIOe-iC9Z1d6x6AY5zATgX217cNjcNtAGDLJ56y8Jr8N/pub?gid=0&single=true&output=csv';

    async function loadFantasyData() {
        const tableBody = document.getElementById('tableBody');
        try {
            const response = await fetch(csvUrl + '&cache=' + new Date().getTime());
            const data = await response.text();
            
            // Clean up rows and remove empty ones
            let rows = data.split('\n').filter(row => row.trim() !== '');
            // Remove the header row
            rows.shift();

            // 1. Safe Sort
            rows.sort((a, b) => {
                const colsA = a.split(',');
                const colsB = b.split(',');
                // Sort by County (Index 0)
                if ((colsA[0] || '') < (colsB[0] || '')) return -1;
                if ((colsA[0] || '') > (colsB[0] || '')) return 1;
                return 0;
            });

            tableBody.innerHTML = ''; 

            rows.forEach(row => {
                // This regex handles names with commas or quotes safely
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                if (cols.length >= 3) { // Ensure at least County and Names exist
                    const tr = document.createElement('tr');
                    
                    // Column Map: A=0(County), B=1(First), C=2(Last), D=3(G), E=4(P), F=5(Total), H=7(Pos)
                    const county = (cols[0] || '').replace(/"/g, '').trim();
                    const first = (cols[1] || '').replace(/"/g, '').trim();
                    const last = (cols[2] || '').replace(/"/g, '').trim();
                    const goals = (cols[3] || '0').trim();
                    const points = (cols[4] || '0').trim();
                    const fPoints = (cols[5] || '0').trim();
                    const pos = (cols[7] || 'N/A').replace(/"/g, '').trim();

                    tr.innerHTML = `
                        <td>${first} ${last}</td>
                        <td>${county}</td>
                        <td>${pos}</td>
                        <td>${goals}</td>
                        <td>${points}</td>
                        <td class="score">${fPoints}</td>
                    `;
                    tableBody.appendChild(tr);
                }
            });
        } catch (err) {
            console.error("Error:", err);
            tableBody.innerHTML = '<tr><td colspan="6">Error loading data. Check console for details.</td></tr>';
        }
    }

    loadFantasyData();
</script>
