<!DOCTYPE html>
<html>
<head>
    <title>GAA Fantasy Hub</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #f0f2f5; color: #333; }
        .box { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #004a99; text-align: center; margin-bottom: 5px; }
        .status { text-align: center; font-size: 0.9em; color: #666; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: left; }
        th { background: #004a99; color: white; text-transform: uppercase; font-size: 0.85em; }
        tr:nth-child(even) { background: #fcfcfc; }
        tr:hover { background: #f1f7ff; }
        .total-cell { font-weight: bold; color: #2e7d32; }
        #debug { margin-top: 20px; padding: 15px; background: #fff5f5; border-left: 5px solid #ff4d4d; display: none; }
        button { display: block; margin: 10px auto; padding: 10px 20px; background: #004a99; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="box">
    <h1>üèÜ Live GAA Fantasy Standings</h1>
    <p class="status">Syncing live with Google Sheets...</p>
    
    <button onclick="fetchData()">üîÑ Refresh Data</button>

    <table id="mainTable">
        <thead>
            <tr>
                <th>Player</th>
                <th>County</th>
                <th>Pos</th>
                <th>Goals</th>
                <th>Points</th>
                <th>Total Score</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="6" style="text-align:center;">Loading scores...</td></tr>
        </tbody>
    </table>

    <div id="debug"></div>
</div>

<script>
    // We use a proxy to tell the browser this request is safe
    const rawUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTcdzjZ4zYlGgFe5acS8xOb1vHR9b8i98UudIOe-iC9Z1d6x6AY5zATgX217cNjcNtAGDLJ56y8Jr8N/pub?output=csv';
    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(rawUrl);

    async function fetchData() {
        const debugBox = document.getElementById('debug');
        const tableBody = document.getElementById('tableBody');

        try {
            // Fetching via proxy to bypass CORS security
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error('Network response was not ok');
            
            const text = await response.text();
            const rows = text.split('\n').filter(r => r.trim() !== '');

            if (rows.length <= 1) {
                tableBody.innerHTML = '<tr><td colspan="6">No data found in sheet.</td></tr>';
                return;
            }

            tableBody.innerHTML = '';
            for (let i = 1; i < rows.length; i++) {
                const cols = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${(cols[0] || '').replace(/"/g, '')}</td>
                    <td>${(cols[1] || '').replace(/"/g, '')}</td>
                    <td>${(cols[2] || '').replace(/"/g, '')}</td>
                    <td>${(cols[3] || '0').replace(/"/g, '')}</td>
                    <td>${(cols[4] || '0').replace(/"/g, '')}</td>
                    <td class="total-cell">${(cols[5] || '0').replace(/"/g, '')}</td>
                `;
                tableBody.appendChild(tr);
            }
            debugBox.style.display = 'none';
        } catch (err) {
            debugBox.style.display = 'block';
            debugBox.innerText = 'Sync Error: ' + err.message + '. Try clicking Refresh in 30 seconds.';
            console.error(err);
        }
    }

    // Initial load
    fetchData();
</script>
</body>
</html>